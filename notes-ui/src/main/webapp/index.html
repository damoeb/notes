<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" xmlns="http://www.w3.org/1999/html"> <!--<![endif]-->
<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title></title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

<link rel="stylesheet" href="components/bootstrap/dist/css/bootstrap.css">
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="components/jquery-ui/themes/base/jquery.ui.all.css">
<!-- Icon Font -->
<link rel="stylesheet" href="components/font-awesome/css/font-awesome.min.css">


<script src="components/modernizr/modernizr.js"></script>

<script src="components/jquery/jquery.js"></script>
<script src="components/jquery-ui/ui/jquery-ui.js"></script>

<script src="components/jquery-timeago/jquery.timeago.js"></script>
<script type="text/javascript">
    jQuery.timeago.settings.strings = {
        prefixAgo: '',
        prefixFromNow: 'in',
        suffixAgo: '',
        suffixFromNow: '',
        seconds: 'now',
        minute: 'a minute',
        minutes: '%d minutes',
        hour: 'an hour',
        hours: '%d hours',
        day: 'a day',
        days: '%d days',
        month: 'a month',
        months: '%d month',
        year: 'a year',
        years: '%d years'
    };
</script>

<script src="components/underscore/underscore-min.js"></script>
<script src="components/backbone/backbone-min.js"></script>

<!-- notifications -->
<!-- see http://needim.github.com/noty/-->
<script src="components/noty/js/noty/jquery.noty.js"></script>

<script src="components/noty/js/noty/layouts/top.js"></script>
<script src="components/noty/js/noty/themes/default.js"></script>

<!-- file upload -->
<script src="scripts/fileupload/jquery.iframe-transport.js"></script>
<script src="scripts/fileupload/jquery.fileupload.js"></script>
<link rel="stylesheet" href="scripts/fileupload/jquery.fileupload-ui.css">

<script src="scripts/plugins.js"></script>

<script type="text/javascript">
    var notes = {};
</script>

<script src="scripts/util.js"></script>
<script src="scripts/editors.js"></script>
<script src="scripts/breadcrumbs.js"></script>
<script src="scripts/basiceditor.js"></script>
<script src="scripts/texteditor.js"></script>
<script src="scripts/pdfeditor.js"></script>
<script src="scripts/documentlist.js"></script>
<script src="scripts/databases.js"></script>
<script src="scripts/folder.js"></script>
<script src="scripts/tree.js"></script>
<script src="scripts/dialog.js"></script>
<script src="scripts/model.js"></script>

<script src="components/noty/js/noty/layouts/top.js"></script>

<script src="scripts/pdf/pdf.js"></script>
<script src="scripts/pdf/textlayerbuilder.js"></script>
<script src="scripts/pdfloader.js"></script>
<link rel="stylesheet" href="scripts/pdf/pdf.css">


<script type="text/javascript">

    $(document).ready(function () {

        // -- Overwrites -----------------------------------------------------------------------------------------------
        var fnCustomParse = function (data) {
            if (_.isObject(data.result)) {
                return data.result;
            } else {
                return data;
            }
        };
        Backbone.Model.prototype.parse = fnCustomParse;
        Backbone.Collection.prototype.parse = fnCustomParse;

        // -- Side Navigation ------------------------------------------------------------------------------------------

        // todo get settings

        notes.app.databaseId(1);

        $('#databases').databases({
            databaseId: notes.app.databaseId()
        });

        var editors = $('#editors').editors();

        // -- Menu -- --------------------------------------------------------------------------------------------------

        $('#settings').button({
            icons: {primary: 'ui-icon-gear'},
            text: false
        }).click(notes.dialog.settings.general);

        $('#create-document')
                .button()
                .click(function () {
                    notes.dialog.document.create();
                });

        $('#import-document')
                .button()
                .click(notes.dialog.document.import)
                .parent().buttonset();

        // todo if file is dropped to document and upload started -> block screen or other indicator
//            var overallProgress = $('#fileupload').fileupload('progress');
//            var activeUploads = $('#fileupload').fileupload('active');

        var $upload = $('#file-upload').
                fileupload({
                    url: '/notes/rest/file/upload',
                    dataType: 'json'
                })
                .bind('fileuploadsubmit', function (e, data) {

                    data.formData = {
                        folderId: notes.app.activeFolderId(),
                        documentId: notes.app.documentId()
                    };
                })
                .bind('fileuploaddone', function (e, xhr) {
                    console.log('done');

                    var model = new notes.model.Document(xhr.result.result);

                    $('#document-list').documentList('updateDocument', model);
                });


        $('#search-input').keypress(function (e) {
            if (e.which == 13) {
                notes.router.navigate('search/' + $(this).val());
            }
        });


        $('#breadcrumbs').breadcrumbs();

        // -- Routing --------------------------------------------------------------------------------------------------

        var Router = Backbone.Router.extend({

            routes: {
                "folder/:id": "folder",
                "search/:query": "search"   // #search/kiwis/p7
            },

            search: function (query) {
                console.log('search ' + query);
                notes.search({
                    query: query,
                    databaseId: notes.app.databaseId()
                })

            },

            folder: function (id) {
                console.log('open folder ' + id);
                $('#document-list').documentList({
                    folderId: id
                });
            }
        });

        notes.router = new Router();

        // start routing
        Backbone.history.start();
    });

    notes.app = new function () {

        var _activeFolderId = 0;
        var _documentId = 0;
        var _databaseId = 0;
        var _descendants = {};

        this.activeFolderId = function (id) {
            if (typeof id != 'undefined') {
                _activeFolderId = id;
            } else {
                return _activeFolderId;
            }
        }
        this.documentId = function (id) {
            if (typeof id != 'undefined') {
                _documentId = id;
            } else {
                return _documentId;
            }
        }
        this.databaseId = function (id) {
            if (typeof id != 'undefined') {
                _databaseId = id;
            } else {
                return _databaseId;
            }
        }

        this.add$Folder = function ($folder) {
            _descendants[$folder.getModel().get('id')] = $folder;
        }

        this.get$Folder = function (folderId) {
            return _descendants[folderId];
        }
    };


</script>

</head>
<body style="background-color: #C5C5C5">

<!--[if lt IE 7]>
<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a></p>
<![endif]-->


<div class="container">

    <!-- HEADER -->
    <div class="row">
        <ul class="list-inline">
            <li>Contact</li>
            <li>Social Media</li>
        </ul>
    </div>
</div>

<div class="container" style="background-color: white; padding-top: 10px; padding-bottom: 10px;">

    <!-- CONTENT TOP -->
    <div class="row" style="padding-top: 20px; padding-bottom: 20px">

        <!-- LEFT -->
        <div class="col-lg-2">
            Logo
        </div>

        <!-- CONTENT -->
        <div class="col-lg-8">
            <div style="float: left;">
                <button id="create-document" title="New Document"><i class="fa fa-file-o"></i></button>
                <button id="import-document" title="Import Document"><i class="fa fa-chain"></i></button>
            </div>
            <input id="search-input" class="ui-widget-content ui-corner-all" type="text" name="query"
                   placeholder="Search"
                   style="width:300px; font-size:14px; padding:3px 4px;"/>
        </div>

        <!-- RIGHT -->
        <div class="col-lg-2">
            <button id="settings">Settings</button>
        </div>

    </div>

    <!-- CONTENT MAIN -->
    <div class="row">

        <!-- LEFT -->
        <div class="col-lg-2 sidebar">
            <!--Sidebar-->
            <dl>
                <dt><i class="fa fa-inbox fa-fw fa-lg"></i> Database</dt>
                <dd>
                    <div id="databases"></div>
                </dd>
                <dt><i class="fa fa-star fa-fw fa-lg"></i> Starred</dt>
                <dt><i class="fa fa-calendar fa-fw fa-lg"></i> Calendar</dt>
                <dt><i class="fa fa-flag fa-fw fa-lg"></i> Important</dt>
                <dt><i class="fa fa-tags fa-fw fa-lg"></i> Tags</dt>

            </dl>

        </div>

        <!-- CONTENT -->
        <div class="col-lg-8">
            <div id="breadcrumbs" class="row">

            </div>
            <div id="document-list" class="row">

            </div>
            <div id="editors" class="row"
                 style="padding-left: 5px; padding-right: 5px; border-right: 1px solid rgb(204, 204, 204); border-left: 1px solid rgb(204, 204, 204)">

            </div>
        </div>

        <!-- RIGHT -->
        <div class="col-lg-2">
            vorschläge
        </div>

    </div>

</div>


<div id="dialog"></div>
<!--<div id="bookmark-preview"-->
<!--style="position:fixed; top:0; left: 0; background-color: white; width: 100%; height: 100%; display:none">-->
<!--&lt;!&ndash;<div style="position: absolute; height: 200px; width: 400px; margin: -100px 0 0 -200px; top: 50%; left: 50%;"><img src="img/spinner.gif"><span style="margin-left:5px">waiting for snapshot</span></div>&ndash;&gt;
-->
<!--<div id="bookmark-preview-pdf" class="pdf-container" style="width: 1024px; margin:auto;"></div>-->
<!--</div>-->
<div style="display: none"><input id="file-upload" type="file" name="files[]" multiple></div>

<script type="text/html" id="document-in-list">

    <div class="doc doc-id-<%=id %>">
        <div class="col-lg-2">
            <img src="<%= thumbnail %>">
        </div>
        <div class="col-lg-9">
            <div class="row" style="font-weight:bold">
                <%=title %>
                <%
                if (star) {
                %>
                <i class="fa fa-star" style="color:red"></i>
                <%
                }
                %>
            </div>
            <div class="row">
                <%=date %> - <%=views %> views
            </div>
            <div class="row">
                <%=text %>
            </div>
        </div>
        <div class="col-lg-1" style="text-align:right">
            <div class="row">
                <i class="fa fa-circle" style="color:green"></i>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="search-result">

</script>

</body>
</html>
